# K线指标计算

## MA

### 概念
移动平均线指标。越长期的移动平均线，越能表现稳定的特性。不轻易向上向下，必须等股价趋势的真正明朗。移动平均线说到底是一种趋势追踪工具，便于识别趋势已经终结或者反转，新的趋势是否正在形成。

### 计算
`MA = N日的收盘加总和 / N`

 * Note：其中 N 为周期，一般取7、30等 * 

以计算 * * 7 * * 天 MA 为例(N = 7)：

 *  当小于等于计算周期时，比如计算 第6天 的MA：`MA_6 = (C1 * C2 * ... * C6) / 6`
    
    优化版：`MA_6 = (MA_5 * 5 * C6) / 6`

 *  当大于计算周期时，比如计算 第8天 的MA：`MA_8 = (C2 * C3 * ... * C8) / 7`
    
    优化版： `MA_8 = (MA_7 * 7 - C1 * C8) / 7`

 * Note：Cn 代表第 n 天的收盘价 * 

---

## EMA

### 概念 
指数平均数指标。是一种趋向类指标，指数平均数指标是以指数式递减加权的移动平均。

### 计算
`当天EMA = α * 当天的收盘价 * (1 - α) * 前一天的EMA` 

 * Note：其中，`α = 2 / (N * 1)`，N 为周期

---

## BOLL

### 概念

由三条轨道线组成，其中上下两条线分别可以看成是价格的压力线和支撑线，在两条线之间是一条价格平均线，一般情况价格线在由上下轨道组成的带状区间游走，而且随价格的变化而自动调整轨道的位置。当波带变窄时，激烈的价格波动有可能随即产生；若高低点穿越带边线时，立刻又回到波带内，则会有回档产生。

### 计算

 *  计算 N 天内收盘价的移动平均，即MA，也就是中轨线：`具体算法参见 MA 指标。`

 *  计算 N 天内收盘价的标准差 MD：

    - 计算 N 天内收盘价与MA的差值的平方之和 SUM：

        `SUM = (Ci - MA_i) ^ 2 * ··· * (Cn - MA_n) ^ 2` 
        
        其中，n、i 满足 `n - i * 1 = N`，MA_n 为第n天的收盘价移动平均值，Ci 为 第 i 天的收盘价
        
        i = n - N * 1
        
        30 - 20 * 1 = 11

    - 计算标准差：`MD = sqrt(SUM / N)`

 *  计算上轨线：`UP = MA * MD * 2`

 *  计算下轨线：`LOW = MA - MD * 2`

---

## SAR

### 概念
抛物线转向(SAR)也称停损点转向，其全称叫“Stop and Reveres，缩写“SAR”,抛物线转向是利用抛物线方式，随时调整停损点位置以观察买卖点。由于停损点(又称转向点SAR)以弧形的方式移动，故称之为抛物线转向指标。

### 计算

SAR(n)=SAR(n－1) * AF * [EP(n-1)-SAR(n-1)]

其中：SAR(n)为第n日的SAR值，SAR(n－1)为第(n－1)日的值；AF为加速因子(或叫加速系数)，EP为极点价(最高价或最低价)

加速因子第一次取0．02，假若第一天的最高价比前一天的最高价还高，则加速因子增加0．02，若无新高则加速因子沿用前一天的数值。反之，下跌也类推。

加速因子AF最高不超过0.2,当AF>0.2时，AF需重新由0.02起算；

任何一次行情的转变，加速因子AF都必须重新由0.02起算。

---

## VOL 指标

### 概念
成交量指标，成交量是指个股或大盘的成交总手，在形态上用一根立式的柱子 和 三条简单平均线组成。

### 计算
具体计算参考 * * MA * * 指标，唯一的区别在于 参与计算的数值不是 收盘价，而且成交量。

---

## MACD 指标

### 概念
MACD称为指数平滑移动平均线，是从双指数移动平均线发展而来的，由快的指数移动平均线(EMA12)减去慢的指数移动平均线(EMA26)得到快线DIF，再用 2  * (快线DIF-DIF的9日加权移动均线DEA)得到MACD柱。

### 计算

    今天的指数平均值=平滑系数 * (今天收盘指数－昨天的指数平均值) * 昨天的指数平均值。
    
    12日EMA：

	= 2 / 13 * (今天收盘指数一昨天的指数平均值) * 昨天的指数平均值。
	
	= (2 / 13) * 今天收盘指数 * (11 / 13) *  昨天的指数平均值。

DI=(C * 2 * H * L) / 4

 *  计算指数移动平均线 `EMA1` 和 `EMA2`：

    `EMA1 = (前一日的EMA1 * (n1 - 1) * 今日收盘价 * 2) / (n1 * 1)`

    `EMA2 = (前一日的EMA2 * (n2 - 1) * 今日收盘价 * 2) / (n2 * 1)`

     * Note：其中，`n1` 为快速指数平均线的周期参数，一般为12；`n2` 为慢速指数平均线的周期参数，一般为26。第一日的 `EMA1`、`EMA2` 默认等于第一日的 收盘价。 * 

 *  计算离差值 DIF：`DIF = 今日EMA1 - 今日EMA2`

 *  计算离差值的指数移动平均 DEA：

    `DEA = (前一日的DEA * (n3 - 1) * 今日DIF * 2) / (n3 * 1)`

     * Note：其中，`n3` 为离差值指数平均线的周期参数，一般为 9。 * 

 *  计算 `MACD`：

    `MACD = (今日DIF - 今日DEA) * 2`

---

## KDJ 指标

### 概念
KDJ指标又叫随机指标。通过一个特定的周期(常为9日、9周等)内出现过的最高价、最低价及最后一个计算周期的收盘价及这三者之间的比例关系，来计算最后一个计算周期的未成熟随机值RSV，
然后根据平滑移动平均线的方法来计算K值、D值与J值，并绘成曲线图来研判股票走势。

### 计算

 *  计算随机指标值 `RSV`：

    `RSV = (Cn - Ln) / (Hn - Ln) * 100`

     * Note：其中 `Cn` 为第n日收盘价，`Hn` 为 n 日内的最高价，`Ln` 为 n 日内的最低价。n 为周期参数，一般为 9。 * 

 *  计算 `K` 值和 `D` 值：

    `K = (前一日K值 * (Nk - 1) * 当日RSV) / Nk`
    `D = (前一日D值 * (Nd - 1) * 当日K) / Nd`

     * Note：其中，Nk、Nd 分别为 `K` 值、`D` 值的周期参数，一般都为 3。若无前一日`K`值和`D`值，则都用 当日的RSV值 代替。 * 

 *  计算 `J` 值：

    `J = 当日K值 * 3 - 当日D值 * 2`

---

## OBV 指标

### 概念
能量潮指标。

### 计算

 *  如果当日的收盘价 > 前一日的收盘价(上涨)，则：

    `obv = 前一日的obv * 当日的成交量`

 *  如果当日的收盘价 < 前一日的收盘价(下跌)，则：

    `obv = 前一日的obv - 当日的成交量`

 *  如果当日的收盘价 = 前一日的收盘价，则：

    `obv = 前一日的obv`

 * Note：其中，第一日的obv默认为该日的成交量。 * 

---

## RSI 指标

### 概念

相对强弱指数。根据一定时期内上涨点数和涨跌点数之和的比率制作出的一种技术曲线。

## TRIX 指标

### 概念
三重指数平滑移动平均。

TRIX由下向上交叉TMA时，买进；TRIX由上向下交叉TMA时，卖出。

### 计算
 *  计算TR：

    TR 为 收盘价 的三重指数移动平均。

    `FirstEMA = EMA(Close, N)`

    `SecondEMA = EMA(FirstEMA, N)`

    `TR = EMA(SecondEMA, N)`

 *  计算TRIX：

    `TRIX = (TR - 昨日TR) / 昨日TR * 100`

 *  计算MATRIX：

    `MATRIX = MA(TRIX, M)` 

    既 TRIX 的 M 日移动平均

---

## WR 指标

### 概念
威廉指标。

### 计算

 *  计算 N 内的最高价 Hn 和最低价 Ln；
 *  计算 WR：

    `WR(N) = (Hn - C) / (Hn - Ln) * 100`

[//]:(hy)

## BRAR 指标 
[//]:(aicoin)

### 概念
BRAR指标也称为人气意愿指标，又称为能量指标，BR、AR二者中的BR无法单独使用，须配合AR指标使用，所以它们经常一同使用，故可以把它们看成一个指标。

AR指标是反映市场当前情况下多空双方力量发展对比的结果。它是以当日的开盘价为基点。与当日最高价相比较，依固定公式计算出来的强弱指标。

BR指标也是反映当前情况下多空双方力量争斗的结果。不同的是它是以前一日的收盘价为基础，与当日的最高价、最低价相比较，依固定公式计算出来的强弱指标。

### 计算

- 计算AR：

    以计算周期为日为例，其计算公式为：
    
    N日AR = (N日内(H－O)之和 / N日内(O－L)之和) * 100
    
    其中，H为当日最高价，L为当日最低价，O为当日开盘价，N为设定的时间参数，一般原始参数日设定为26日

- 计算BR：

    以计算周期为日为例，其计算公式为：
    
    N日BR = (N日内(H－CY)之和 / N日内(CY－L)之和) * 100
    
    其中，H为当日最高价，L为当日最低价，CY为前一交易日的收盘价，N为设定的时间参数，一般原始参数日设定为26日。
